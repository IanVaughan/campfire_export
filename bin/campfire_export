#!/usr/bin/env ruby

unless Kernel.respond_to?(:require_relative)
  module Kernel
    def require_relative(path)
      require File.join(File.dirname(caller[0]), path.to_str)
    end
  end
end

require_relative '../lib/timezone'
require_relative '../lib/campfire_export'

CONFIG = YAML.load_file(File.join(ENV['HOME'], '.campfire_export.yaml'))

def parse_date(date_str)
  date_str.nil? ? nil : Date.parse(date_str)
end

account = CampfireExport::Account.new(CONFIG['subdomain'], CONFIG['api_token'])
account.export(parse_date(CONFIG.fetch('start_date', nil)), 
               parse_date(CONFIG.fetch('end_date', nil)))